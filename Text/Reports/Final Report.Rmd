---
title: "Final Report - Health of New Zealand Lakes"
author: "Russell and Frances"
date: "5th October 2022"
output: bookdown::pdf_document2
---

# Introduction


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(300570258, kind = "Mersenne-Twister")

require(tinytex)
require(klaR)
require(ggplot2)
require(ggthemes)
require(extrafont)
require(ggstance)
require(fitdistrplus)
require(ggcorrplot)
require(GGally)
require(ggExtra)
require(moments)
require(kable)
require(kableExtra)
require(reshape2)
require(dplyr)
require(gridExtra)
require(tidyverse)
require(nortest)
require(MASS)
```


We are Russell and Frances and we form Group 8. Below are our pictures as well as our contact details and ORCID ID numbers.  
  
```{r frances, out.width = "40%", out.height = "30%", echo = FALSE}
knitr::include_graphics("../Presentations/Russell and Frances.png")
```
  
**Frances Smith**  
email: frances.j.smith.nz@gmail.com  
ORCHID ID: 0000-0002-5168-3134

**Russell Syder**  
email: russellsyder@gmail.com  
ORCHID ID: 0000-0002-4582-5909

## Introduction to our data
  
Our original dataset was extracted from Stats NZ.
https://www.stats.govt.nz/indicators/modelled-lake-water-quality/ 

We made some manipulations to the original dataset such as removing extraneous variables (like Date which was the same for every lake) or variables that we were not interested in. We also reshaped some aspects of the dataset so that the data would be easier to analyse. We checked for missing values; there were some for the categorical variables, which we dealt with as described below, but there were no missing values for the numerical variables so imputation was not necessary.  
  
Our final dataset contains information from 3802 lakes (exceeding one hectare) in New Zealand measured across 22 variables. Of these 22 variables we selected 10 that we would use for further analysis. They are as follows:  
  
*Ammoniacal Nitrogen* is a form of nitrogen that supports algae and plant growth, but in large concentrations can be toxic to aquatic life. This is measured in milligrams per litre. The national bottom line for this measure is 1.3mg/L, which none of the observations exceed. It acts as as measure of toxicity.  
  
*Chlorophyll-A* is an organic molecule found in plant cells that allows plants to photosynthesize. The variable Chlorophyll-A is a measure of the concentration of phytoplankton biomass in milligrams per cubic metre. High concentrations of chlorophyll is a symptom of degraded water quality. The national bottom line for this measure is 12.  

*Total Phosphorus* is the sum of all phosphorus forms in the water, including phosphorus bound to sediment. Large amounts of phosphorus in lakes can reduce dissolved oxygen in the water. This can cause low oxygen areas in the lake, where some aquatic life cannot survive. Total Phosphorus is measured in milligrams per cubic metre and has a national bottom line of 50mg/m3.  

*Total Nitrogen* is the sum of all nitrogens found in the water, including organic nitrogen from plant tissue. An excess of nitrogen in lakes can cause an increase in algae and plant growth, possibly depriving the lake of oxygen. Total Nitrogen is measured in milligrams per cubic metre and the national bottom line for stratified lakes is 750mg/m3, and for polymictic lakes is 800mg/m3.  
  
*Clarity* is measured in Secchi depth. This is the maximum depth (in metres) a black and white Secchi disk is visible from the surface of the lake.  

*Area* is the surface area of the lake measured in metres squared.  

*Perimeter* is the overall perimeter of the lake, in metres.  

*Lake Depth* is the maximum depth of the lake measured in metres.  
  
*Dominant Landcover* is split into four types; Exotic Forest, Native, Pastoral and Urban area. There are 12 lakes with no entry for Dominant Landcover, however in the description of the dataset by Stats NZ, it states all lakes have been categorised, and indicated these empty entries should be another category called 'Other' that includes 'Gorse and/or Broom', 'Surface mines and dumps', 'Mixed exotic shrubland', and 'Transport infrastructure' so we have assigned these to the Other category. The category Urban area is applied if urban cover exceeds 15 percent of catchment area. Pastoral is applied if pastoral landcover exceeds 25 percent of catchment area, if the lake has not already been assigned urban. The other three categories; Exotic forest, Native, or Other were assigned according to the largest land cover type by area, if not already assigned urban or pastoral.  
  
*Regions* in this dataset are; Auckland, Bay of Plenty, Canterbury, Gisborne, Hawke's Bay, Whanganui, Marlborough, Northland, Otago, Southland, Taranaki, Tasman, Waikato, Wellington and West Coast. Each lake corresponds to the region it is located in.

Upon first examining our data we thought that it would be prudent to group certain similar variables together for analysis. Specifically, the 4 variables that gave a measure of the levels of a given substance in a lake, and additionally clarity, we grouped as the "Lake Health variables" as for all of them, high levels of any of these variables can indicate poor lake health, with the exception of clarity, where, in general, higher values indicate better lake health.  

We also grouped together lake Area, Perimeter, and Depth and classified this group as the Lake Dimension variables.  

## Leading Question

Our leading question was; What are some statistics that we can produce that may be beneficial for informing restorative actions that improve the health of lakes in New Zealand?  

To investigate this we came up with the following questions;  

- Are there any particular regions that have poor lake health?  

- Do the Lake Health variables predict one another?  

- How can we model the Lake Dimension variables?  

- Do any types of Dominant Landcover have poorer lake health than others?

# Methodology

To answer these questions, we will conduct the following investigations:  

- An Exploratory Data Analysis on the Lake Health, Lake Dimension, Region and Dominant Landcover variables, which will consist of:  

  - Univariate analysis of the Lake Health and Lake Dimension variables  
  
  - Multivariate analysis with each of these four types of variables, specifically:  
  
    - Relationship between the Lake Health and Lake Dimension variables, and  
    
    - Comparisons of the Lake Health and Lake Dimension variables by Region and Dominant Landcover  

- Tests for difference in means of the Lake Health variables by Dominant Landcover  

- Principal Component Analysis on the Lake Health variables  

- Factor Analysis on the Lake Health Variables  

- Linear Discriminant Analysis on the Lake Health variables by Dominant Landcover  

The latter four analyses will be in our Results section.  

## Exploratory Data Analysis

```{r functab, echo = FALSE}
MySummary2 <- function(x){
  return(c(
    length(x),
    min(x),
    quantile(x, .25),
    median(x),
    quantile(x, .75),
    max(x),
    sd(x),
    mean(x),
    kurtosis(x), 
    skewness(x))
  )
}
```

### Univariate Analysis of the Lake Health Variables

Table \ref{tab:laketable} shows the summary statistics for each of these three measures. 

```{r laketable, echo = FALSE}
lake <- read.csv("../../Data/modelled_lake_water_quality_altered.csv")
laketype <- as.factor(lake$nof_lake_type)

region <- as.factor(lake$region)
land <- as.factor(lake$dominant_landcover)
df <- data.frame(lake)
NH4N <- lake$median_NH4N_mg.L..1
CHLA <- lake$median_CHLA_mg.m.3
TP <- lake$median_TP_mg.m.3
TN <- lake$median_TN_mg.m.3
SECCHI <- lake$median_SECCHI_metre

df1 <- data.frame(NH4N, CHLA, TP, TN, SECCHI)
df2 <- data.frame(land, NH4N, CHLA, TP, TN, SECCHI)
tab <- apply(df1, MySummary2, MARGIN = 2)
tab <- as.table(tab)

rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c('Ammoniacal Nitrogen', 'Chloropyll-A', 'Phosphorus', "Nitrogen", "Clarity")
knitr::kable(tab, caption = "Table of Sample Statistics", "simple")
```


Figure \ref{fig:nh4nhist} shows the distribution of Ammoniacal Nitrogen. The fitted normal distribution (in red) differs significantly from the smoothed histogram (purple). The smoothed histogram is more skewed and the mode is well below the mean. The median 0.0096 and mean 0.0120. Table \ref{tab:laketable} confirms this with a skewness of 2.0339. The kurtosis is 8.1158, indicating the distribution of Ammoniacal Nitrogen has heavy tails. There are two extreme values, at around 0.06 mg per litre. There is a large amount of observations around the first quantile, 0.0073 mg per litre. 

```{r nh4nhist, fig.cap="Histogram of Ammoniacal Nitrogen", fig.pos="center", echo=FALSE}
ggplot(df, aes(x=NH4N)) +
  geom_histogram(aes(y=..density..),
                 bins = nclass.FD(unlist(NH4N)),
                 col="black", fill="white") +
  xlab("Observations of Ammonical Nitrogen") +
  ylab("Histogram, smoothed histogram, and estimated normal density") +
  geom_density(kernel="epanechnikov", size=2, col="purple", alpha=.1, adjust = 2) +
  stat_function(fun = "dnorm", args=list(mean=mean(NH4N), sd=sd(NH4N)),
                col="red", size=2, alpha=.5) +
   geom_vline(xintercept = mean(NH4N), col="red") +
  geom_segment(aes(x=mean(NH4N)-sd(NH4N),
                   y=15,
                   xend=mean(NH4N)+sd(NH4N),
                   yend=15), col="red", alpha=.3) +
  geom_boxplot(aes(y=-10), width=7, notch = TRUE)+
  theme_tufte()
```
  

Figure \ref{fig:chlahist} shows the distribution of Chlorophyll-A. We can see the fitted normal distribution differs slightly from the smoothed histogram. Table \ref{tab:laketable} shows the median is 3.9482 and the mean is 4.6093. The kurtosis is 18.3408, indicating the distribution of Chlorophyll-A is very heavy tailed, and the skewness is 2.5484, indicating the distribution is right skewed. A small proportion of the lakes exceeded the national bottomline of 12mg per cubic metre. 

```{r chlahist, fig.cap="Histogram of Chlorophyll-A", fig.pos="center", echo=FALSE}
ggplot(df, aes(x=CHLA)) +
  geom_histogram(aes(y=..density..),
                 bins = nclass.FD(unlist(CHLA)),
                 col="black", fill="white") +
  xlab("Observations of Chlorophyll-A") +
  ylab("Histogram, smoothed histogram, and estimated normal density") +
  geom_density(kernel="epanechnikov", size=2, col="purple", alpha=.1, adjust = 2) +
  stat_function(fun = "dnorm", args=list(mean=mean(CHLA), sd=sd(CHLA)),
                col="red", size=2, alpha=.5) +
   geom_vline(xintercept = mean(CHLA), col="red") +
  geom_vline(xintercept = 12, col="blue") +
  geom_segment(aes(x=mean(CHLA)-sd(CHLA),
                   y=0.02,
                   xend=mean(CHLA)+sd(CHLA),
                   yend=0.02), col="red", alpha=.3) +
  geom_boxplot(aes(y=-0.01), width=0.01, notch = TRUE)+
  theme_tufte()
```

Figure \ref{fig:tphist} shows the distribution of Total Phosphorus. The fitted normal distribution (red) fits quite well to the smoothed histogram (purple), although the kurtosis is very high, 26.2763. We would expect the kurtosis of a normally distributed variable to be close to 3 and with a skewness of 0, however the sample statistics of Total Phosphorus show the kurtosis much larger than 3 and the skewness 2.8722. This indicates the tails of this distribution are much heavier than a normal distribution, and it is right skewed. Table \ref{tab:laketable} shows the median of Total Phosphorus is 17.8966 mg per cubic meter, and the mean is 18.7206 mg per cubic meter. Few of the lakes exceeded the national bottomline of 50mg per cubic metre. 


```{r tphist, fig.cap="Histogram of Total Phosphorus", fig.pos="center", echo=FALSE}
ggplot(df, aes(x=TP)) +
  geom_histogram(aes(y=..density..),
                 bins = nclass.FD(unlist(TP)),
                 col="black", fill="white") +
  xlab("Observations of Total Phosphorus") +
  ylab("Histogram, smoothed histogram, and estimated normal density") +
  geom_density(kernel="epanechnikov", size=2, col="purple", alpha=.1, adjust = 2) +
  stat_function(fun = "dnorm", args=list(mean=mean(TP), sd=sd(TP)),
                col="red", size=2, alpha=.5) +
  geom_vline(xintercept = mean(TP), col="red") +
  geom_vline(xintercept = 50, col="blue") +
  geom_segment(aes(x=mean(TP)-sd(TP),
                   y=0.007,
                   xend=mean(TP)+sd(TP),
                   yend=0.007), col="red", alpha=.3) +
  geom_boxplot(aes(y=-.005), width=.003, notch = TRUE)+
  theme_tufte()
```
  
  
Figure \ref{fig:TNhist} shows the distribution of Total Nitrogen. The fitted normal distribution (in red) differs significantly from the smoothed histogram (purple). The smoothed histogram is more skewed and the mode is well below the mean. The median 416.7044 and mean 505.8606. Table \ref{tab:laketable} confirms this with a skewness of 1.0799. The kurtosis is 3.5463, indicating the distribution of Total Nitrogen has reasonable tails. A significant proportion of the observations exceed the higher of the two national bottomlines, of 800mg per cubic metre. 

```{r TNhist, fig.cap="Histogram of Total Nitrogen", fig.pos="center", echo=FALSE}
ggplot(df, aes(x=TN)) +
  geom_histogram(aes(y=..density..),
                 bins = nclass.FD(unlist(TN)),
                 col="black", fill="white") +
  xlab("Observations of Total Nitrogen") +
  ylab("Histogram, smoothed histogram, and estimated normal density") +
  geom_density(kernel="epanechnikov", size=2, col="purple", alpha=.1, adjust = 2) +
  stat_function(fun = "dnorm", args=list(mean=mean(TN), sd=sd(TN)),
                col="red", size=2, alpha=.5) +
   geom_vline(xintercept = mean(TN), col="red") +
  geom_vline(xintercept = 800, col="blue") +
  geom_segment(aes(x=mean(TN)-sd(TN),
                   y=0.00035,
                   xend=mean(TN)+sd(TN),
                   yend=0.00035), col="red", alpha=.3) +
  geom_boxplot(aes(y=-.0005), width=.0003, notch = TRUE)+
  theme_tufte()
```
  
Figure \ref{fig:SECCHIhist} shows the distribution of Clarity. The fitted normal distribution (in red) differs from the smoothed histogram (purple). The smoothed histogram is slightly asymmetrical but not skewed, with a median of 4.4677 and a mean of 4.4510. Table \ref{tab:laketable} confirms this with a skewness of 0.2342. The kurtosis is 1.9983, indicating the distribution of Clarity has slightly lighter tails than a normal distribution. These statistics indicate the distribution of Clarity is close to normal. 
  
```{r SECCHIhist, fig.cap="Histogram of Clarity (in metres)", fig.pos="center", echo=FALSE}
ggplot(df, aes(x=SECCHI)) +
  geom_histogram(aes(y=..density..),
                 bins = nclass.FD(unlist(SECCHI)),
                 col="black", fill="white") +
  xlab("Observations of Clarity in metres") +
  ylab("Histogram, smoothed histogram, and estimated normal density") +
  geom_density(kernel="epanechnikov", size=2, col="purple", alpha=.1, adjust = 2) +
  stat_function(fun = "dnorm", args=list(mean=mean(SECCHI), sd=sd(SECCHI)),
                col="red", size=2, alpha=.5) +
   geom_vline(xintercept = mean(SECCHI), col="red") +
  geom_segment(aes(x=mean(SECCHI)-sd(SECCHI),
                   y=0.05,
                   xend=mean(SECCHI)+sd(SECCHI),
                   yend=0.05), col="red", alpha=.3) +
  geom_boxplot(aes(y=-.05), width=.03, notch = TRUE)+
  theme_tufte()

```  

We have made Cullen and Frey plots for Ammoniacal Nitrogen, Chlorophyll-A, Total Phosphorus, Total Nitrogen and Clarity, each with 1000 bootstrapped observations, shown in orange. 

In figure \ref{fig:cfNH4N}, the Cullen and Frey graph of Ammoniacal Nitrogen, we can see the observed kurtosis and square of skewness was much larger than a normal distribution. The observation and all bootstrapped values were within the Beta distribution region, indicating the distribution of Ammoniacal Nitrogen in New Zealand lakes may follow a Beta distribution. 

Figure \ref{fig:cfCHLA} shows the Cullen and Frey graph of Chlorophyll-A. The observed kurtosis and square of skewness were both much larger than we would expect for a normal distribution. The observed value and the bootstrapped observations lie on or just below the line all lognormal distributions lie on. This could tell us the distribution of Chlorophyll-A in New Zealand lakes could follow a lognormal distribution.

The Cullen and Frey graph of Total Phosphorus is shown in figure \ref{fig:cfTP}. The observed kurtosis and square of skewness were larger than both Ammoniacal Nitrogen and Chlorophyll-A. Similar to the Cullen and Frey graph of Chlorophyll-A, the observed value and bootstrapped observations seem to lie close to the line that contains all lognormal distributions. However, very few of the bootstrapped observations lie on this line, indicating Total Phosphorus in New Zealand lakes likely does not follow a lognormal, or any other distribution illustrated on this graph. 

The Cullen and Frey graph of Total Nitrogen is shown in figure \ref{fig:cfTN}. The observed value and the boostrapped observations all lie within the grey area suggesting that Total Nitrogen follows a Beta distribution. 

The Cullen and Frey graph of Clarity is shown in figure \ref{fig:cfSECCHI}. The observed value and bootstrapped values of the skewness and kurtosis of Clarity lies within the area all beta distributions exist within, and very close to the Uniform distributions, indicating the distribution of Clarity could be Uniform or Beta.  


```{r cfNH4N, fig.cap = "Cullen and Frey Graph of Ammoniacal Nitrogen", echo = FALSE}
descdist(NH4N, boot = 1000)
```

```{r cfCHLA, fig.cap = "Cullen and Frey Graph of Chlorophyll-A", echo = FALSE}
descdist(CHLA, boot = 1000)
```

```{r cfTP, fig.cap = "Cullen and Frey Graph of Total Phosphorus", echo = FALSE}
descdist(TP, boot = 1000)
```
  
    
```{r cfTN, fig.cap = "Cullen and Frey Graph of Total Nitrogen", echo = FALSE}
descdist(TN, boot = 1000)
```
  
```{r cfSECCHI, fig.cap = "Cullen and Frey Graph of Clarity", echo = FALSE}
descdist(SECCHI, boot = 1000)
```

We believe, based on the Cullen and Frey graphs, none of these distributions are normal. We confirmed this with Anderson Darlings tests of normality. Table \ref{tab:adhealth} shows the test statistic and p-value for the Anderson Darling test on each Lake Health variable. The test statistics for Ammoniacal Nitrogen, Chlorophyll-A, Total Phosphorus, Total Nitrogen and Clarity are 226, 111, 68, 134 and 40, respectively (to the nearest whole number). For each variable, the p-value is 3e-24, confirming our suspicions that these variables are not normally distributed. 

```{r adhealth, fig.cap = "Anderson-Darling Test for Normality of Ammoniacal Nitrogen in Lakes with Predominantly Exotic Forest Landcover", fig.pos = "center", echo = FALSE}
tab <- ad.test(df1$NH4N)
tstatr <- tab$statistic
tstatr1 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr1 <- format(pvalr, scientific = TRUE)

tab <- ad.test(df1$CHLA)
tstatr <- tab$statistic
tstatr2 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr2 <- format(pvalr, scientific = TRUE)

tab <- ad.test(df1$TP)
tstatr <- tab$statistic
tstatr3 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr3 <- format(pvalr, scientific = TRUE)

tab <- ad.test(df1$TN)
tstatr <- tab$statistic
tstatr4 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr4 <- format(pvalr, scientific = TRUE)

tab <- ad.test(df1$SECCHI)
tstatr <- tab$statistic
tstatr5 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr5 <- format(pvalr, scientific = TRUE)
tab <- matrix(c(tstatr1, pvalr1, tstatr2, pvalr2, tstatr3, pvalr3, tstatr4, pvalr4, tstatr5, pvalr5), nrow = 2, byrow = FALSE)
tabr <- as.table(tab)
rownames(tabr) <- c("Test Statistic", "P-Value")
colnames(tabr) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tabr, caption = "Anderson-Darling Test Statistic and P-value for the Lake Health Variables")
```


### Univariate Analysis of the Lake Dimension Variables

```{r, echo = FALSE}

area<- data.frame(lake$lake_area)
perim<- data.frame(lake$lake_perimeter)
depth<- data.frame(lake$lake_depth)
region1 <- data.frame(lake$region)

df.ADP <- cbind(area,perim,depth, region1)
colnames(df.ADP) <- c("Area", "Perimeter", "Depth", "Region")

```
We gathered information on the Lake Dimension Variables: Depth, Area and Perimeter. In the univariate analysis we produced summary statistics as well as histograms of their distributions.  
  
We first produced summary statistics as seen in table \ref{tab:ADPtab}.

```{r ADPtab, fig.cap = "Table of Sample Statistics for Area, Perimeter and Depth", fig.pos = "center", echo = FALSE}

df.ADP1 <- cbind(area, perim, depth)

tab <- apply(df.ADP1, MySummary2, MARGIN = 2)
tab <- as.table(tab)
rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c('Area', 'Perimeter', 'Depth')
knitr::kable(tab, caption = "Table of Sample Statistics", "simple")
```
  
We produced histograms of each of the Lake Dimension Variables to examine their distributions. 
  
```{r HistDepth,  fig.cap = "Log 10 transformed Histogram of Lake Depth in meters squared. Rectangles indicate skewed distribution, red vertical line indicates thge placement of the median value, red horizontal line indicates the placement of the median with one standard deviation.", echo = FALSE, message = FALSE, warning=FALSE}

ggplot(lake, aes(x=lake_depth)) + 
  geom_histogram(color = "black", fill = "white", alpha = 2, bins = 50)+
  labs(x = "Lake Depth in meters^2", y = "Count", title = "log 10 transformed Histogram of count of Lake Depth in Meters^2")+
   geom_vline(aes(xintercept=median(lake_depth)),
            color="red",  size=1)+
  geom_segment(aes(x=median(lake_depth)-sd(lake_depth),
                   y=5,
                   xend=median(lake_depth)+sd(lake_depth),
                   yend=5), col="red", alpha=.3)+
  geom_boxplot(width = 1)+
  scale_y_log10()+
  theme_tufte()
```
  
Figure \ref{fig:HistDepth} shows the log 10 transformed histogram of the Lake Dimension Variable Lake Depth. We transformed it by log 10 to make the graph easier to interpret. The distribution of the graph is strongly skewed to the right, this is indicated by the boxplot at the bottom of the graph. Additionally from the boxplot we see that our data contains many outliers. The boxplot also suggests that with the removal of these outliers we may have a distribution that better approximates normal. We decided not to remove the outliers as these are still valid data points.

This distribution and interpretation of the above graph is very similar for all of the Lake Dimension variables; they all require log 10 transformation, they are all highly skewed, and appear to not approximate a normal distribution. As such we have not reproduced the histograms of the Lake Dimension variables Area and Perimeter here.

### Multivariate Analysis of Lake Health Variables

Table \ref{tab:corramat} shows the correlation matrix and figure \ref{fig:correlationplot} shows the visualization of this matrix. The strength of relationship is interpreted the size of the circles with strong relationships having larger circles and weaker relationships having small circles. Strength is also communicated via colour with darker colours indicating stronger relationship. Colour also indicates the direction of the relationship via a colour spectrum with reddish indicating a positive relationship, blue indicating a negative relationship and white indicating no relationship.  

Ammoniacal Nitrogen has a weak, positive relationship with Chlorophyll-A (0.2076) and a Moderate, positive relationship with Total Phosphorus (0.3746). It has quite a strong relationship with Total Nitrogen (0.7294, which is to be expected asTotal Nitrogen includes Ammoniacal Nitrogen). Chlorophyll-A has a reasonably strong relationship with both Total Phosphorus (0.6939), and  a moderate relationship with Total Nitrogen (0.5553). Total Phosphorus has a reasonable strong relationship with Total Nitrogen of (0.64533). These statistics suggest that there may be a positive relationship between the different molecules in water.  

Clarity is the only variable to have any negative relationship with the other variables. Clarity has a negative correlation with all of the other variables of at least -0.5. It has an especially strong relationship with Total Nitrogen of -0.7823. These negative relationships are to be expected as it makes sense that an increase of other molecules in water would reduce the water's clarity. We can see this represented as dark blue circles in figure \ref{fig:correlationplot}.  


```{r corramat, fig.cap = "Correlation Matrix of Lake Health", fig.pos = "center", echo = FALSE}
tab <- cor(df1)
tab <- as.table(tab)
rownames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
colnames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tab, caption = "Correlation Matrix")
```

```{r correlationplot, fig.cap="Visualisation of the Correlation Matrix", fig.pos="center", echo=FALSE, warning = FALSE}
Ammoniacal_Nitrogen <- lake$median_NH4N_mg.L..1
Chlorophyll_A <- lake$median_CHLA_mg.m.3
Total_Phosphorus <- lake$median_TP_mg.m.3
Total_Nitrogen <- TN
Clarity <- SECCHI
df11 <- data.frame(Ammoniacal_Nitrogen, Chlorophyll_A, Total_Phosphorus, Total_Nitrogen, Clarity)
ggcorrplot(cor(df11), method = "circle", hc.order = TRUE, type = "lower")
```


Figure \ref{fig:pairsplot} shows the pairs plot of the Lake Health variables, coloured by Dominant Landcover. We can see some separation between landcovers in the distribution of each variable. The relationships between Ammoniacal Nitrogen, Chlorophyll-A, Total Phosphorus and Total Nitrogen are positive, however all show non-constant scatter. It is also difficult to see any separation between the landcovers in these scatterplots as the data is dominated by Native and Pastoral landcovers (both have 1770 observations). The relationship between these four measures and Clarity are all negative, and appear to be non-linear. Another observation from this graph is that the correlations differ greatly between landcovers. For Ammoniacal Nitrogen and Chlorophyll-A, Native and Pastoral landcover groups have a weak positive correlation, while the other three types of landcover have weak negative correlations. The correlations between Ammoniacal Nitrogen and Total Phosphorus is similar for Exotic Forest, Native and Pastoral lakes (weak to moderate positive correlation), while the correlations for Other and Urban Area are very weak. For the rest of the pairs, the correlations for each landcover was similar, with either all positive or all negative correlations, ranging from 0.3 less to 0.3 more than the collective correlation. The two types of landcover that tended to differ most are the Other and Urban Area landcovers. This may be due to the small size of these groups (12 observations for Other and 85 observations for Urban Area).  

```{r pairsplot, fig.cap="Pairs Plot of Lake Health", fig.pos="center", echo=FALSE, message = FALSE}
ggpairs(df11, aes(col=land, alpha=.5))
```

Next, we wanted to compare the distribution of the lake health variables by types of dominant landcover. Figure \ref{fig:boxNH4N} illustrates the box plots for each type of landcover. The observations have been log transformed to show the distributions better. We can see the highest 75% of Ammoniacal Nitrogen measures in Urban areas are above the lower 75% of measures in Exotic forest and Native landcovers. This could inidcate a relationship between landcover and Ammoniacal Nitrogen. Exotic forest and Native landcovers tend to have lower amounts of Ammoniacal Nitrogen in the lake water than in Pastoral, Urban and Other landcovers. The medians are shown in tables \ref{tab:eftabby}, \ref{tab:nattabby}, \ref{tab:ottabby}, \ref{tab:pasttabby} and \ref{tab:urbtabby} show the median Ammoniacal Nitrogen for lakes with Exotic forest, Native, Other, Pastoral and Urban dominant landcover to be 0.0084040, 0.0075540, 0.0123870, 0.0124780 and 0.0150880, respectively. There is a clear difference between the medians, with lower medians in Exotic forest and Native landcovers. 

```{r boxNH4N, fig.cap = "Box Plot of Landcover and Ammoniacal Nitrogen", notch=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(df, aes(x=land, y=NH4N)) + 
    geom_boxplot(notch = TRUE, fill = "pink")+
  theme(axis.text.x = element_text(size=7, angle=90, hjust=1),
legend.position = "none")+
  xlab("Dominant Landcover")+
  ylab("Ammoniacal Nitrogen")+  
  scale_y_log10() +
  theme_tufte()
```

Figure \ref{fig:boxCHLA} shows the distribution of Chlorophyll-A in each type of landcover. The observations have been log transformed to show the distributions better. We can see very similar distributions in Exotic forest, Other, Pastoral and Urban landcovers, however, lakes with Native landcover tended to have much lower levels of Chlorophyll-A than other landcovers. The medians support this, with the median Chlorophyll-A level of lakes with Native landcover being 2.8754, while all other types of landcover had medians above 5 mg per cubic meter (as shown in tables \ref{tab:eftabby}, \ref{tab:nattabby}, \ref{tab:ottabby}, \ref{tab:pasttabby} and \ref{tab:urbtabby}).

```{r boxCHLA, fig.cap = "Box Plot of Landcover and Chlorophyll-A", echo = FALSE, warnings=FALSE, message = FALSE}
ggplot(df, aes(x=land, y=CHLA)) + 
    geom_boxplot(notch = TRUE, fill = "lightblue")+
  theme(axis.text.x = element_text(size=7, angle=90, hjust=1),
legend.position = "none")+
  xlab("Dominant Landcover")+
  ylab("Chlorophyll-A")+  
  scale_y_log10() +
  theme_tufte()
```

Figure \ref{fig:boxTP} shows the distribution of Total Phosphorus for each type of dominant landcover. The observations have been log transformed to show the distributions better. The Native landcover group appears to have lower levels of Phosphorus than the other landcover types, with the third quantile being below the first quantile of all other categories. 

Tables \ref{tab:eftabby}, \ref{tab:nattabby}, \ref{tab:ottabby}, \ref{tab:pasttabby} and \ref{tab:urbtabby} show the median levels of Phosphorus are 22.610470, 12.176880, 21.836995, 21.650210 and 21.416020 for Exotic forest, Native, Other, Pastoral and Urban landcovers, respectively. We can clearly see the level of Phosphorus in lakes with Native landcover tended to be much lower than other landcover types. 


```{r boxTP, fig.cap = "Box Plot of Landcover and Total Phosphorus", notch=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(df, aes(x=land, y=TP)) + 
    geom_boxplot(notch = TRUE, fill = "lightgreen")+
  theme(axis.text.x = element_text(size=7, angle=90, hjust=1),
legend.position = "none")+
  xlab("Dominant Landcover")+
  ylab("Total Phosphorus")+
  scale_y_log10() +
  theme_tufte()
```

Figure \ref{fig:boxTN} shows the distributions of Total Nitrogen for each type of dominant landcover. Similarly to Ammoniacal Nitrogen, Chlorophyll-A and Total Phosphorus, the lakes with native landcover appeared to have lower levels of Total Nitrogen. The other types of dominant landcover appear to have very similar distributions, with the distribution of Total Nitrogen in lakes with Urban landcover being slightly higher. Tables \ref{tab:eftabby}, \ref{tab:nattabby}, \ref{tab:ottabby}, \ref{tab:pasttabby} and \ref{tab:urbtabby} show the median levels of Nitrogen are 556.8908, 286.4589, 724.3681, 558.8725 and 725.8646 for Exotic forest, Native, Other, Pastoral and Urban landcovers, respectively. These statistics support the claim that lakes with Native landcover tend to have lower levels of Nitrogen than other types of dominant landcover.

```{r boxTN, fig.cap = "Box Plot of Landcover and Total Nitrogen", notch=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(df, aes(x=land, y=TN)) + 
    geom_boxplot(notch = TRUE, fill = "violet")+
  theme(axis.text.x = element_text(size=7, angle=90, hjust=1),
legend.position = "none")+
  xlab("Dominant Landcover")+
  ylab("Total Nitrogen")+
  scale_y_log10() +
  theme_tufte()
```

The distribution of Clarity by dominant landcover is shown in figure \ref{fig:boxSECCHI}. The lakes with Native landcover appear to have a higher clarity, or appear clearer than lakes with other types of dominant landcover. Lakes with Urban or 'Other' landcover are less clear. This is to be expected as we have found that higher levels of Ammoniacal Nitrogen, Chlorophyll-A, Total Phosphorus and Total Nitrogen are associated with lower levels of Clarity. Tables \ref{tab:eftabby}, \ref{tab:nattabby}, \ref{tab:ottabby}, \ref{tab:pasttabby} and \ref{tab:urbtabby} show the median levels of Clarity are 2.9450, 5.4663, 2.3282, 3.3240 and 2.1811 for Exotic forest, Native, Other, Pastoral and Urban landcovers, respectively. We can say that lakes with Native landcover tend to be clearer than lakes with other types of dominant landcover. 


```{r boxSECCHI, fig.cap = "Box Plot of Landcover and Clarity", notch=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(df, aes(x=land, y=SECCHI)) + 
    geom_boxplot(notch = TRUE, fill = "yellow")+
  theme(axis.text.x = element_text(size=7, angle=90, hjust=1),
legend.position = "none")+
  xlab("Dominant Landcover")+
  ylab("Clarity")+
  scale_y_log10() +
  theme_tufte()
```

```{r eftabby, echo = FALSE}
A <- filter(df2, land == "Exotic forest")
A = A[,-1]
A <- data.frame(A)
tab <- apply(A, MySummary2, MARGIN = 2)
tab <- as.table(tab)
rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tab, caption = "Table of Sample Statistics for Exotic Forest Landcover", "simple")
```

```{r nattabby, echo = FALSE}
A <- filter(df2, land == "Native")
A = A[,-1]
A <- data.frame(A)
tab <- apply(A, MySummary2, MARGIN = 2)
tab <- as.table(tab)
rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tab, caption = "Table of Sample Statistics for Native Landcover", "simple")
```

```{r ottabby, echo = FALSE}
A <- filter(df2, land == "Other")
A = A[,-1]
A <- data.frame(A)
tab <- apply(A, MySummary2, MARGIN = 2)
tab <- as.table(tab)
rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tab, caption = "Table of Sample Statistics for Other Landcover", "simple")
```

```{r pasttabby, echo = FALSE}
A <- filter(df2, land == "Pastoral")
A = A[,-1]
A <- data.frame(A)
tab <- apply(A, MySummary2, MARGIN = 2)
tab <- as.table(tab)
rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tab, caption = "Table of Sample Statistics for Pastoral Landcover", "simple")
```

```{r urbtabby, echo = FALSE}
A <- filter(df2, land == "Urban area")
A = A[,-1]
A <- data.frame(A)
tab <- apply(A, MySummary2, MARGIN = 2)
tab <- as.table(tab)
rownames(tab) <- c('Sample Size','Minimum','1st Quantile', 'Median', '3rd Quantile', 'Maximum', 'Standard Deviation', 'Mean', 'Kurtosis', 'Skewness')
colnames(tab) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tab, caption = "Table of Sample Statistics for Urban Landcover", "simple")
```


We wanted to run tests for a difference in mean of each Lake Health variable for each type of landcover, but we first needed to check the normality assumptions to ascertain which tests we could conduct. If any one of these groups does not meet the normality assumption, normality cannot be assumed for these tests. To test this we conducted Anderson-Darling tests on just the Native landcover group. 

Table \ref{tab:adhelth} shows the test statistic and p-value for the Anderson Darling test on each Lake Health variable for the Native landcover. The test statistics for Ammoniacal Nitrogen, Chlorophyll-A, Total Phosphorus, Total Nitrogen and Clarity are 209, 92, 58, 168 and 21, respectively (to the nearest whole number). For each variable, the p-value is 3e-24, confirming our suspicions that the distribution of the Lake Health variables for Native lakes are not normally distributed, violating the normality assumption. We conducted this test on every type of landcover with similar results.  

```{r adhelth, fig.cap = "Anderson-Darling Test for Normality of the Lake Health Variables in Lakes with Native Dominant Landcover", fig.pos = "center", echo = FALSE}
land <- as.factor(lake$dominant_landcover)
df2 <- data.frame(land, NH4N, CHLA, TP, TN, SECCHI)
A <- filter(df2, land == "Native")
A = A[,-1]
A <- data.frame(A)
tab <- ad.test(A$NH4N)
tstatr <- tab$statistic
tstatr1 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr1 <- format(pvalr, scientific = TRUE)
A <- filter(df2, land == "Native")
A = A[,-1]
A <- data.frame(A)
tab <- ad.test(A$CHLA)
tstatr <- tab$statistic
tstatr2 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr2 <- format(pvalr, scientific = TRUE)
A <- filter(df2, land == "Native")
A = A[,-1]
A <- data.frame(A)
tab <- ad.test(A$TP)
tstatr <- tab$statistic
tstatr3 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr3 <- format(pvalr, scientific = TRUE)
A <- filter(df2, land == "Native")
A = A[,-1]
A <- data.frame(A)
tab <- ad.test(A$TN)
tstatr <- tab$statistic
tstatr4 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr4 <- format(pvalr, scientific = TRUE)
A <- filter(df2, land == "Native")
A = A[,-1]
A <- data.frame(A)
tab <- ad.test(A$SECCHI)
tstatr <- tab$statistic
tstatr5 <- round(tstatr, 4)
pvalr <- tab$p.value
pvalr5 <- format(pvalr, scientific = TRUE)
tab <- matrix(c(tstatr1, pvalr1, tstatr2, pvalr2, tstatr3, pvalr3, tstatr4, pvalr4, tstatr5, pvalr5), nrow = 2, byrow = FALSE)
tabr <- as.table(tab)
rownames(tabr) <- c("Test Statistic", "P-Value")
colnames(tabr) <- c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity")
knitr::kable(tabr, caption = "Anderson-Darling Test Statistic and P-value for the Lake Health Variables by Native Landcover")
```

Table \ref{tab:regfreq} is a frequency table for the number of lakes in each region. The North Island regions are; Auckland, Bay of Plenty, Gisborne, Hawke's Bay, Manawatu/Whanganui, Northland, Taranaki, Waikato and Wellington. The South Island regions are; Canterbury, Marlborough District Council, Otago, Southland, Tasman District Council and West Coast. We can see the majority if the lakes are in the South Island, specifically in Southland. 

```{r regfreq, fig.cap = "Table of Regional Frequencies", fig.pos = "center", echo = FALSE}
Region <- data.frame(lake$region)
tab <- table(Region)
tab <- tab[-1]
knitr::kable(tab, caption = "Frequency table of number of lakes in each Region", colnames = c('Region', 'Frequency'), "simple")

```

We then looked at the summary statistics of region by the Lake Health variables, shown in table \ref{tab:lakehealthbyregion}. From this table we can see quite clearly there is a difference in median Lake Health between regions. Each region had similar median levels of Ammoniacal Nitrogen. We can see a slight difference in the median levels of Chlorophyll-A and Clarity between regions, specifically between regions in the North Island and regions in the South Island. Lakes in the South Island tended to have lower levels of Chlorophyll-A and be clearer than North Island lakes. This is even more apparent when looking at Total Phosphorus and Total Nitrogen. For Total Nitrogen, the 7 regions with the highest median levels of Total Nitrogen were all North Island regions, and the 5 regions with the lowest medians were South Island regions. A similar pattern is to be seen in Total Phosphorus. 



```{r lakehealthbyregion, fig.cap = "Table of Summary Statistics of Lake Health Variables by Region", fig.pos = "center", echo = FALSE}

LakeTable <- filter(lake, !region == "") %>%
  group_by(region) %>%
  summarise_at(vars(c(median_NH4N_mg.L..1, median_CHLA_mg.m.3, median_TP_mg.m.3, median_TN_mg.m.3, median_SECCHI_metre)), list(median = median))

 LakeTable <- rename(LakeTable, c("Ammoniacal Nitrogen" = median_NH4N_mg.L..1_median, 
                                  "Chlorophyll-A" = median_CHLA_mg.m.3_median,
                                  "Total Phosphorus" = median_TP_mg.m.3_median,
                                  "Total Nitrogen" = median_TN_mg.m.3_median, 
                                  "Clarity" =  median_SECCHI_metre_median,))
                                  
                                  
knitr::kable(LakeTable, caption = "Table of Median values of Lake Health Variables by Region", "simple")
```
 

### Multivariate analysis of the Lake Dimension variables  

Examining the Correlation between Area, Depth and Perimeter  NEED TO EDIT REFERENCING AND TITLES  
*Correlation matrix rounded to three decimal place   
  
```{r, echo=FALSE}
##correlation matrix, rounded to three decimal places
LakeNum<-select(lake, c(lake_perimeter, lake_depth, lake_area))
LakeCat<-select(lake, region)
round(cor(LakeNum), 3)

```
  
  
Visualisation of the Correlation Matrix:  
  
```{r VisCorr1, fig.cap= "Visual of the correlation between, depth, perimeter and area where Strength and direction of relationship are indicated by circle size and colour", echo=FALSE, warning = FALSE}

###A visualisation of the correlation matrix:
ggcorrplot(cor(LakeNum), method = "circle",
           hc.order = TRUE,
           type = "lower") +
  ggtitle("Visual correlation matrix of Area, Perimeter and Depth")+
  theme_bw()

```
  
  As to be expected, the three Lake Dimension have positive correlations with one another. The correlation between lake area and lake depth isn't small but it is smaller than one may expect. Lake Perimeter has a rather strong relationship with both area and depth. 

We then examined Regions and the lake dimension variables
```{r, echo = FALSE}

area<- data.frame(lake$lake_area)
perim<- data.frame(lake$lake_perimeter)
depth<- data.frame(lake$lake_depth)
region1 <- data.frame(lake$region)

df.ADP <- cbind(area,perim,depth, region1)
colnames(df.ADP) <- c("Area", "Perimeter", "Depth", "Region")

```
 
We then examined the means and medians of the Lake Dimension variables for the Regions. Here we have produced barplots for the mean and median of depth.
<br />
 View of the Mean and Median for Lake Depth

<br />

```{r MeanDepth, fig.cap= "Barplot of regional mean lake Depth", echo = FALSE}

LakeTable <-filter(lake, !region == "") %>%
  group_by(region) %>%
  summarise_at(vars(lake_depth), list(mean = mean))

LakeTable<- data.frame(LakeTable)

ggplot(data=LakeTable, aes(x=region, y=mean)) +
  geom_bar(color = "lightblue", fill = "lightblue", alpha = 2, stat="identity")+
  labs(y = "Mean Lake Depth in metres", title = 
         "Mean Lake Depth of Region in metres")+
  coord_flip()+
  theme_tufte()
```
<br />
<br />
  
```{r MedianDepth, fig.cap= "Barplot of regional median lake depths", echo = FALSE}

LakeTable <-filter(lake, !region == "") %>%
  group_by(region) %>%
  summarise_at(vars(lake_depth), c(list(mean = mean), list(median = median)))

#which.max(Lake$lake_perimeter)

LakeDf<- data.frame(LakeTable)

ggplot(data=LakeDf, aes(x=region, y=median)) +
  geom_bar(color = "lightblue", fill = "lightblue", alpha = 2, stat="identity")+
  labs(y = "Median Lake Depth in metres", title = 
         "Median Lake Depth of Region in metres")+
  coord_flip()+
  theme_tufte()
```
<br />
<br />

Depth:
What we can tell from the bargraphs that there is not much difference in distribution between the regions in Lake Depth, however, the mean for each region is approximately 5 meters deeper than the median. This suggests that across most regions there are some much deeper lakes. There are some exceptions to this such as Gibsborne.  
  
    
We have not repeated the analysis for area and perimeter here as the results are very similar to those of depth where the means are noticeably larger than the medians.

We then checked the relationship between the Lake Health variables and the Lake Dimension variables.  
  
Figure \ref{fig:pairhd} shows the pairs plot of the Lake Health variables by the Lake Dimension variables. We can see very little relationship between the Lake Health and Lake Dimension variables. The majority of the scatter we can see if due to outliers and large amounts of lakes with low values for depth, perimeter and area. We decided not to investigate these relationships any further. 

```{r pairhd, fig.cap = "Pairs Plot of Lake Health Variables by Lake Dimension Variables", echo = FALSE}
depth <- lake$lake_depth
area <- lake$lake_area
peri <- lake$lake_perimeter

df3 <- data.frame(land, NH4N, CHLA, TP, TN, SECCHI, depth, area, peri)
p <- df3 %>% ggpairs(.,
               title = "A Nice Plot Using ggpairs", 
               mapping = ggplot2::aes(colour=land), 
               diag = list(discrete="barDiag", 
                           continuous = wrap("densityDiag", alpha=0.5 )), 
               upper = list(combo = wrap("box_no_facet", alpha=0.5),
                            continuous = wrap("cor", size=4, alignPercent=0.8))) + 
               theme(panel.grid.major = element_blank()) 
              

plots <- apply(expand.grid(i=7:9, j=2:6), 1, function(ij) getPlot(p, i=ij[1], j=ij[2]))
ggmatrix(plots,
         byrow=FALSE,
         nrow = 3,
         ncol=5,
         xAxisLabels = c("Ammoniacal Nitrogen", "Chlorophyll-A", "Total Phosphorus", "Total Nitrogen", "Clarity"),
         yAxisLabels = c("Depth", "Area", "Perimeter"),
         title="Lake Health Variables by Lake Dimension Variables")
```


# Results

## Tests for Difference in Mean Lake Health

As demonstrated in our Exploratory data Analysis, the distributions of the Lake Health variables for each landcover type are not normal. We performed Kruskal-Wallis tests for equality in means between landcover types for each Lake Health variable and all of these tests concluded that there was a difference. We then conducted pairwise Wilcox tests to discover which landcovers had different means to others. These were done at the 0.01 significance level.  


We conducted a pairwise Wilcox test for difference in means between pairs. This concluded that there is a difference between mean Ammoniacal Nitrogen levels in lakes with Exotic forest landcover and lakes with 'Other' landcover, as the p-value is 0.0004. There is also a difference in mean Ammoniacal Nitrogen levels in lakes with 'Other' landcover and lakes with Native landcover, with a p-value of 0.0001. Lakes with Pastoral landcover have a different mean Ammoniacal Nitrogen level than lakes with Exotic forest landcover, and lakes with Native landcover, both have a p-value of less than 2e-16. Lakes with Urban landcover have a different mean Ammoniacal Nitrogen level than lakes with Exotic forest landcover, and lakes with Native landcover, both have a p-value of less than 2e-16. And lakes with Urban landcover have a different mean Ammoniacal Nitrogen level than lakes with Pastoral landcover, as the p-value is 9e-7. The pairs that failed to reject the null hypothesis were Exotic forest and Native landcovers, Pastoral and 'other' landcovers and Urban and 'other' landcovers so there could be no difference between the mean Ammoniacal Nitrogen level in lakes in these landcover pairs. 

```{r krnh4npair, echo = FALSE}
pairwise.wilcox.test(NH4N, land,
                 p.adjust.method = "BH")

```


Next we conducted a pairwise Wilcox test for difference in mean Chlorophyll-A levels between pairs. This concluded that there is a difference between mean Chlorophyll-A levels in lakes with Native landcover and every other type of landcover. The p-value for the Native and Exotic forest pair was less than 2e-16, Native and 'Other' pair was 6.4e-5, Native and Pastoral pair was less than 2e-16 and Native and Urban was less than 2e-16. No other pair had a p-value small enough to reject the null hypothesis that there is not a difference in mean Chlorophyll-A level between those two landcovers. We can conclude that lakes with Native landcover had a different mean Chlorophyll-A level than any other landcover type. 

```{r krchlapair, echo = FALSE}
pairwise.wilcox.test(CHLA, land,
                 p.adjust.method = "BH")

```



We conducted a pairwise Wilcox test for difference in means between pairs. This concluded that there is a difference between mean Total Phosphorus levels in lakes with Native landcover and every other type of landcover. The p-value for the Native and Exotic forest pair was less than 2e-16, Native and 'Other' pair was 4.0e-6, Native and Pastoral pair was less than 2e-16 and Native and Urban was less than 2e-16. We can conclude that lakes with Native landcover had a different mean Total Phosphorus level than any other landcover type. The p-value for Pastoral and Exotic forest is 1.4e-7 and the p-value for Urban and Exotic forest was 0.001. So we can conclude lakes with Exotic forest landcover had a different mean Total Phosphorus level than lakes with Pastoral landcover or lakes with Urban landcover. No other pair had p-values small enough to conclude a difference in means.  

```{r krtppair, echo = FALSE}
pairwise.wilcox.test(TP, land,
                 p.adjust.method = "BH")

```




Next we conducted a pairwise Wilcox test for difference in means between pairs. This found that there is a difference between mean Total Nitrogen levels in lakes with Native landcover and every other type of landcover. The p-value for the Native and Exotic forest pair was less than 2e-16, Native and 'Other' pair was 8.9e-7, Native and Pastoral pair was less than 2e-16 and Native and Urban was less than 2e-16. We can conclude that lakes with Native landcover had a different mean Total Nitrogen level than any other landcover type. The p-value for 'other' and Exotic forest is 0.0017 and the p-value for Urban and Exotic forest was 4.4e-8. So we can conclude lakes with Exotic forest landcover had a different mean Total Nitrogen level than lakes with 'Other' landcover or lakes with Urban landcover. The p-value for Pastoral and Urban lancovers was 8.9e-7. indicating there is a difference in mean Total Nitrogen levels in lakes with Pastoral landcover and lakes with Urban. No other pair had p-values small enough to conclude a difference in means.  

```{r krtnpair, echo = FALSE}
pairwise.wilcox.test(TN, land,
                 p.adjust.method = "BH")

```



Next we conducted a pairwise Wilcox test for difference in means between pairs. This concluded that there is a difference between mean Clarity in lakes with Native landcover and every other type of landcover. The p-value for the Native and Exotic forest pair was less than 2e-16, Native and 'Other' pair was 6.1e-6, Native and Pastoral pair was less than 2e-16 and Native and Urban was less than 2e-16. We can conclude that lakes with Native landcover had a different mean Clarity level than any other landcover type. The p-value for Pastoral and urban area is 1.9e-10 and the p-value for Urban and Exotic forest was 2.6e-7. So we can conclude lakes with Urban area landcover had a different mean level of Clarity than lakes with Pastoral landcover or lakes with Exotic forest landcover. No other pair had p-values small enough to conclude a difference in means.  

```{r ksecchippair, echo = FALSE}
pairwise.wilcox.test(SECCHI, land,
                 p.adjust.method = "BH")

```





## Principal Component Analysis

We decided to conduct a Principal Component Analysis on the Lake Health variables to determine whether we can reduce the number of variables while still retaining most of the information. Figure \ref{fig:pca} shows the scree graph of the five principal components. We can see from the summary below that the first principal component explains 65.6% of the variance, with the second principal component this becomes 83.4% and with the third they capture 92.4% of the variance.   

```{r pca, fig.cap = "Scree Graph", fig.pos = "center", echo = FALSE}
health.PCA <- prcomp(df1, center=TRUE, scale=TRUE)
plot(health.PCA, type="l")
```

```{r pcasum, echo = FALSE}
summary(health.PCA)
```


The eigenvectors are below, and shown visually in figure \ref{fig:egraph}. We can see the first principal component is approximately the average of the Lake Health variables. If we were to move forward with the principal components we would just retain principal components 1 and 2 as they capture 83.4% of the variance.  

```{r eigvect, echo = FALSE}
health.PCA$rotation

```


```{r egaph, fig.cap = "Visualisation of the Eigenvctors", fig.pos = "center", echo = FALSE}
Rotation.df <- data.frame(t(health.PCA$rotation))
Rotation.df$PC <- c("PC1", "PC2", "PC3", "PC4", "PC5")
Rotation.melt <- melt(Rotation.df, id.vars = "PC")
ggplot(Rotation.melt) +
geom_line(aes(x=variable, y=value, group=PC, col=PC), size=1.5, alpha=.7)
```

## Factor Analysis

We decided to perform a Factor analysis on the Lake Health variables to determine whether they could be explained using two factors. The null hypothesis for this test was that two factors are sufficient to capture the full dimensionality of the Lake Health variables. The output of this test showed a chi-square test statistic of 65.57 on one degree of freedom and a p-value of 5.59e-16. We concluded, at the 0.01 significance level, that two factors are not sufficient to capture the full dimensionality of these variables. The output of this test is shown below. 

```{r fact, echo = FALSE}
factanal(df1, factors = 2)
```

  
## Linear Discriminant Analysis  

For Linear Discriminant Analysis (LDA), we wanted to see if there was potential to implement LDA if there was information loss. As such, we attempted to predict which Dominant Landcover a lake was, based on the Lake Health variables.

Reminder -  the categories that Dominant Landcover can take on are: Exotic Forest, Native, Other, Pastoral and Urban area.  
  
We first scaled the Lake Health Variables. We then randomly created training and test sets with 70% of the data in the training set and 30% in the test set. We then fit the LDA model using the train data. The output was shown below.



```{r, echo = FALSE}
lake3 <- select(lake, dominant_landcover, median_NH4N_mg.L..1, median_CHLA_mg.m.3, median_TP_mg.m.3, median_TN_mg.m.3, median_SECCHI_metre)
lake4 <- filter(lake3, dominant_landcover == "Pastoral" | dominant_landcover == "Native")

lake3[2:6] <- scale(lake3[2:6])

set.seed(123)
sample <- sample(c(TRUE, FALSE), nrow(lake3), replace=TRUE, prob=c(0.7,0.3))

train <- lake3[sample, ]
test <- lake3[!sample, ]

model1 <- lda(dominant_landcover~., data=train)
model1

```

From the Prior Probabilities we see that Pastoral Landcover and Native Landcover each explain about 46% of the prior probabilities in the training set.  
  
  From examining the coefficients of the linear discriminants, it seems that Total nitrogen (TN) impacts the first linear discriminant the most (-0.8323.). 

Examining the proportion of traces we see that the LD1 accounts for approximately 91 percent of the separation. LD2 and LD3 account for approximately 4.8 and 3.5 percent of the separation respectively. The remainder is explained by LD4.

We produced a partition plot to examine the separation.  
  
  
```{r, echo = FALSE}
lake3$dominant_landcover<- as.factor(lake3$dominant_landcover)
partimat(dominant_landcover ~ ., data=lake3, method="lda")

```

It is difficult to get much useful information from the the Partition Plot. What we can see is that there is a reasonable number of errors. We can also see is that most of the data seems to be in two of the partitions and some of the partitions have no observations in them.  
  
  
```{r echo=FALSE, include=FALSE}
predicted <- predict(model1, test)
mean(predicted$class==test$dominant_landcover)

```
  
  
  We then looked at the accuracy of the model and found that the model had approximately 73% accuracy. We were reasonably happy with this. However, one thing that bothered us was the partition plot and how difficult it was to decipher and the fact the prior probabilities for two of our classes (Pastoral Landcover and Native Landcover) were so much higher than the others. We decided to investigate just these two classes as they accounted for about 93% of the observations in our sample.
  
  
  

```{r, echo = FALSE}

lake4[2:6] <- scale(lake4[2:6])

set.seed(123)
sample <- sample(c(TRUE, FALSE), nrow(lake4), replace=TRUE, prob=c(0.7,0.3))

train <- lake4[sample, ]
test <- lake4[!sample, ]


lake4$dominant_landcover<- as.factor(lake4$dominant_landcover)

model <- lda(dominant_landcover~., data=train)
model

predicted <- predict(model, test)


lake5 <- sample(lake4, size = 100, replace = TRUE )

```
  
  In the second LDA both groups had prior probabilities of 0.5 (this is because the train happened to split them with an equal number of observations of 1242 each.  

```{r, echo = FALSE}
lake4$dominant_landcover<- as.factor(lake4$dominant_landcover)
partimat(dominant_landcover ~ ., data=lake4, method="lda")

```
  
The Partition plot while not any easier to interpret, sorted groups more appropriately and did not have unused partitions. We still see plenty of errors. The individual graphs give error rates between 0.218 and 0.29.

  
```{r, include =FALSE}
mean(predicted$class==test$dominant_landcover)
```

The accuracy was only slightly better at 76.7%.  
  
  The implications of this LDA investigation suggest are that Dominant Landcover may be an indicator of the levels of lake health variables in a given lake. Therefore, if we know whether a lake has native or pastoral landcover, this could give us an indication on the health of a lake. It also means that in the case that the Dominant Landcover observation is lost for a lake, the value may be able to be imputed (with a note mentioning the imputation) with some level of accuracy by using the values from the Lake Health variables. 



# Discussion

- WHAT DOES IT MEEEAAAAAANNNNNNN
- problems
  - clarity  (not always possible as you may just have a shallow lake).  
  - blank region
  - non-normality
  - landcover other
  

Native dff to every other landcover in terms of lake health
pca first 2 83.4%
factor 2 not suff


focus resources to north island, specifically wikato


# Bibliography

- I have some references from research into health variables and where data from 
- APA referencing


data: https://www.stats.govt.nz/indicators/modelled-lake-water-quality/ 




